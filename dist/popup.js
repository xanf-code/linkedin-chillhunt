document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("domain-select"),t=document.getElementById("job-title"),n=document.getElementById("search-query-label"),o=document.getElementById("location"),r=document.getElementById("time-minutes"),a=document.getElementById("search-button"),i=document.getElementById("status"),s=document.getElementById("query-helper"),c=document.getElementById("hide-promoted-toggle"),d=document.getElementById("hide-viewed-toggle"),l=document.getElementById("hide-easy-apply-toggle"),p=document.getElementById("blocked-companies-list"),u=document.getElementById("clear-all-companies"),h=document.getElementById("toggle-blocked-section"),m=document.getElementById("blocked-companies-content"),g=document.getElementById("time-hours-display"),y=document.getElementById("ai-button-container"),f=document.getElementById("generate-ai-button");let R=[];function O(){if(p.innerHTML="",0===R.length){const e=document.createElement("div");return e.className="no-companies-message",e.textContent="No companies blocked yet",void p.appendChild(e)}R.forEach((e=>{const t=document.createElement("div");t.className="blocked-company-item";const n=document.createElement("div");n.className="company-name",n.textContent=e;const o=document.createElement("button");o.className="remove-company-btn",o.textContent="Remove",o.addEventListener("click",(()=>function(e){R=R.filter((t=>t!==e)),chrome.storage.sync.set({blockedCompanies:R},(function(){console.log(`Removed ${e} from blocked companies`),O()}))}(e))),t.appendChild(n),t.appendChild(o),p.appendChild(t)}))}h.addEventListener("click",(function(){m.classList.toggle("collapsed"),h.textContent=m.classList.contains("collapsed")?"▶":"▼"})),chrome.storage.sync.get({hidePromoted:!1,hideViewed:!1,hideEasyApply:!1,blockedCompanies:[]},(function(e){c.checked=e.hidePromoted,d.checked=e.hideViewed,l.checked=e.hideEasyApply,R=e.blockedCompanies||[],O()})),r.addEventListener("input",(function(){const e=parseInt(this.value);if(!isNaN(e)&&e>0){const t=(e/60).toFixed(1);g.textContent=` = ${t} hr${"1.0"!==t?"s":""}`}else g.textContent=""})),u.addEventListener("click",(function(){0!==R.length&&confirm("Are you sure you want to clear all blocked companies?")&&(R=[],chrome.storage.sync.set({blockedCompanies:[]},(function(){console.log("Cleared all blocked companies"),O()})))})),c.addEventListener("change",(function(){try{chrome.storage.sync.set({hidePromoted:c.checked})}catch(e){console.error("Error saving hidePromoted setting:",e),i.textContent="Error saving settings. Please try again."}})),d.addEventListener("change",(function(){try{chrome.storage.sync.set({hideViewed:d.checked})}catch(e){console.error("Error saving hideViewed setting:",e),i.textContent="Error saving settings. Please try again."}})),l.addEventListener("change",(function(){try{chrome.storage.sync.set({hideEasyApply:l.checked})}catch(e){console.error("Error saving hideEasyApply setting:",e),i.textContent="Error saving settings. Please try again."}}));const v={software:'("intern" OR "internship" OR "co-op" OR "cooperative") AND ("software" OR "software engineering" OR "software development" OR "full stack" OR "front end" OR "back end" OR "mobile" OR "app development" OR "web development")',devops:'("intern" OR "internship" OR "co-op" OR "cooperative") AND ("devops" OR "cloud" OR "infrastructure" OR "site reliability" OR "SRE" OR "CI/CD" OR "platform engineering" OR "systems")',product:'("intern" OR "internship" OR "co-op" OR "cooperative") AND ("product management" OR "product manager" OR "product owner" OR "PM" OR "APM" OR "associate product")',data:'("intern" OR "internship" OR "co-op" OR "cooperative") AND ("data science" OR "data scientist" OR "machine learning" OR "ML" OR "AI" OR "analytics" OR "data analyst" OR "data engineering" OR "big data")',security:'("intern" OR "internship" OR "co-op" OR "cooperative") AND ("cybersecurity" OR "security" OR "information security" OR "infosec" OR "network security" OR "application security" OR "security operations" OR "pentesting")',ux:'("intern" OR "internship" OR "co-op" OR "cooperative") AND ("UX" OR "UI" OR "user experience" OR "user interface" OR "design" OR "interaction design" OR "visual design" OR "product design")'};e.addEventListener("change",(function(){const o=e.value;"askAI"===o?(n.textContent="Ask ChillHuntAI",t.value="",t.placeholder="(Ex: Backend Java Software internship)",t.disabled=!1,s.textContent="",y.style.display="block"):"custom"===o?(n.textContent="Search Query",t.value="",t.placeholder="Enter your custom search query",t.disabled=!1,s.textContent="Enter your custom search terms",y.style.display="none"):(n.textContent="Search Query",t.value=v[o],t.disabled=!0,s.textContent="Pre-defined search query for "+e.options[e.selectedIndex].text,y.style.display="none")})),f.addEventListener("click",(async function(){const e=t.value.trim();if(e){i.textContent="Generating optimized search query...",f.disabled=!0,f.textContent="Generating...";try{const n={model:"deepseek-chat",messages:[{role:"system",content:'You are a specialized LinkedIn search optimizer. Your task is to help users create effective Boolean search filters for LinkedIn job searching based on the job title and role they provide.\nWhen a user provides a job title and role (e.g., "software engineer internship"), analyze it and generate a Boolean search string with the following characteristics:\nBreak down the input into:\nPosition type (internship, full-time, contract, etc.)\nCore job function (engineer, analyst, manager, etc.)\nIndustry/specialty (software, marketing, finance, etc.)\nFor each component, generate relevant synonyms and alternatives.\nFormat the output as a proper LinkedIn Boolean search string using:\nParentheses for grouping related terms\n"OR" operators between alternatives\n"AND" operators between different concept groups\nPresent the final search string in a code block for easy copying.\nFor example:\nIf the user says "software engineer internship or co-op"\nRespond with: ("intern" OR "internship" OR "co-op" OR "cooperative") AND ("software" OR "software engineering" OR "software development")\nAdditional guidelines:\nInclude industry-specific terminology when relevant\nAdd quotes around multi-word phrases\nFocus only on generating the search string without additional career advice\nOnly reply with the Boolean search string itself - no additional text, explanations, or comments\nProvide nothing but the search string in the response'},{role:"user",content:e}],stream:!1},o=await fetch("https://api.deepseek.com/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer sk-945c8bfb67854fb2af7279590178fd3e"},body:JSON.stringify(n)});if(!o.ok)throw new Error(`API call failed with status: ${o.status}`);let r=(await o.json()).choices[0].message.content.trim();r.startsWith("```")&&r.endsWith("```")&&(r=r.substring(3,r.length-3).trim()),t.value=r,i.textContent="AI-optimized search query generated!"}catch(n){console.error("Error generating AI query:",n),i.textContent="Error generating query. Using fallback options...";const o=[`("${e}") AND ("entry level" OR "junior" OR "associate")`,`"${e}" AND ("recent graduate" OR "new grad" OR "entry level")`,`("${e}") AND ("internship" OR "co-op" OR "trainee")`,`"${e}" AND ("beginner" OR "junior" OR "starting")`,`("${e}") AND ("graduate program" OR "development program")`],r=o[Math.floor(Math.random()*o.length)];t.value=r}finally{f.disabled=!1,f.innerHTML='\n        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n          <path d="M12 2a8 8 0 0 0-8 8c0 5 6 10 8 10s8-5 8-10a8 8 0 0 0-8-8Z"></path>\n          <path d="M7 11.5a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1Z"></path>\n          <path d="M17 11.5a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1Z"></path>\n          <path d="M12 15a2 2 0 0 0 2-2h-4a2 2 0 0 0 2 2Z"></path>\n        </svg>\n        Generate with AI\n      '}}else i.textContent="Please enter a job description for AI to help with"})),a.addEventListener("click",(function(){const e=t.value.trim(),n=o.value.trim(),a=r.value.trim();if(!e)return i.textContent="Please enter a search query or select a domain",void t.focus();let s="";a&&!isNaN(a)&&parseInt(a)>0&&(s="&f_TPR=r"+60*parseInt(a));let c=`https://www.linkedin.com/jobs/search/?keywords=${encodeURIComponent(e)}`;n&&(c+=`&location=${encodeURIComponent(n)}`),s&&(c+=s),chrome.tabs.query({active:!0,currentWindow:!0},(function(e){chrome.tabs.update({url:c}),window.close()}))}));try{chrome.tabs.query({active:!0,currentWindow:!0},(function(n){if(!n[0].url.includes("linkedin.com"))return;const a=new URL(n[0].url),i=new URLSearchParams(a.search);if(i.has("keywords")){const n=i.get("keywords").replace(/%22/g,'"');t.value=n;for(const[o,r]of Object.entries(v))if(n===r){e.value=o,t.disabled=!0,s.textContent="Pre-defined search query for "+e.options[e.selectedIndex].text;break}}if(i.has("location")&&(o.value=i.get("location").replace(/%22/g,'"')),i.has("f_TPR")&&i.get("f_TPR").startsWith("r")){const e=i.get("f_TPR").substring(1),t=Math.floor(parseInt(e)/60);isNaN(t)||(r.value=t)}}))}catch(e){console.error("Error parsing URL:",e)}}));